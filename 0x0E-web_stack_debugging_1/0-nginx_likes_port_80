#!/usr/bin/env bash
# This script configures Nginx to listen on port 80

# Install Nginx (if not already installed)
apt-get update
apt-get install -y nginx

# Ensure Nginx is running
service nginx start

# Check if Nginx is listening on port 80
if ! ss -tnl | grep -q ':80 '; then
    # Configure Nginx to listen on port 80
    sed -i 's/8080/80/g' /etc/nginx/sites-enabled/default

    # Reload Nginx configuration
    service nginx restart
fi

# Verify that Nginx is now listening on port 80
if ss -tnl | grep -q ':80 '; then
    echo "Nginx is now listening on port 80 for all active IPv4 IPs."
else
    echo "Failed to configure Nginx to listen on port 80."
fi
